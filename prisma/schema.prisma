// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite" // Alterado conforme seu exemplo
  url      = env("DATABASE_URL")
}

// Enum para os cargos de usuário
enum Role {
  USER
  ADMIN
}

// Modelo de Usuário baseado no seu DBML e exemplo
model User {
  id        Int      @id @default(autoincrement()) // ID como Int
  username  String  @unique // Do seu DBML
  nickname  String?  // Do seu DBML
  role      Role     @default(USER) // Do seu DBML
  bio       String?  // Do seu DBML
  createdAt DateTime @default(now()) // Boa prática, do seu exemplo

  // Relações
  posts          PostReceita[] // Receitas que o usuário criou
  reviews        Review[]      // Reviews que o usuário fez
  savedRecipes   PostReceita[] @relation("SavedRecipes") // Receitas salvas (M2M)
  following      Follow[]      @relation("following") // Quem este usuário segue
  followedBy     Follow[]      @relation("followedBy") // Quem segue este usuário
}

// Modelo de Receita (antigo postsReceita)
model PostReceita {
  id          Int      @id @default(autoincrement()) // ID como Int
  title       String
  ingredients String   // @db.Text para 'text' no Postgres
  body        String    // @db.Text para 'text' no Postgres
  status      String?
  createdAt   DateTime @default(now())

  // Relação com o criador (User)
  user    User     @relation(fields: [userId], references: [id])
  userId  Int      // Chave estrangeira como Int

  // Relações
  reviews   Review[] // Reviews desta receita
  savedBy   User[]   @relation("SavedRecipes") // Usuários que salvaram (M2M)
}

// Modelo para Reviews
model Review {
  id         Int      @id @default(autoincrement()) // ID como Int
  title      String
  body       String    // @db.Text para 'text' no Postgres
  rate       Int      // A nota (rating)
  status     String?
  createdAt  DateTime @default(now())

  // Relação com User
  user    User     @relation(fields: [userId], references: [id])
  userId  Int      // Chave estrangeira como Int

  // Relação com PostReceita
  receita    PostReceita @relation(fields: [id_receita], references: [id])
  id_receita Int         // Chave estrangeira como Int

  // Garante que um usuário só pode avaliar uma receita uma vez
  @@unique([userId, id_receita])
}

// Modelo para a tabela 'follows' (Seguidores)
model Follow {
  created_at DateTime @default(now())

  // Relação de quem segue
  following_user_id Int // Chave estrangeira como Int
  following         User  @relation("following", fields: [following_user_id], references: [id])

  // Relação de quem é seguido
  followed_user_id Int // Chave estrangeira como Int
  followedBy       User  @relation("followedBy", fields: [followed_user_id], references: [id])

  // Chave primária composta
  @@id([following_user_id, followed_user_id])
}